// Generated by Selenium IDE
const { Builder, By, Key, until } = require('selenium-webdriver')

const firefox = require('selenium-webdriver/firefox');

let driver
let vars
async function waitForWindow(timeout = 2) {
    await driver.sleep(timeout)
    const handlesThen = vars["windowHandles"]
    const handlesNow = await driver.getAllWindowHandles()
    if (handlesNow.length > handlesThen.length) {
      return handlesNow.find(handle => (!handlesThen.includes(handle)))
    }
    throw new Error("New window did not appear before timeout")
  }

async function s() {




    const service = new firefox.ServiceBuilder(`${process.cwd()}/geckodriver`);
    const options = new firefox.Options();
    options.addArguments('-headless');
    driver = await new Builder().forBrowser('firefox').setFirefoxOptions(options).setFirefoxService(service).build()
    vars = {}

    await driver.get("https://yngal.com/")
    await driver.findElement(By.css("#formSign > div:nth-child(1) > input")).click()
    await driver.findElement(By.css("#formSign > div:nth-child(1) > input")).click()
    await driver.findElement(By.css("#formSign > div:nth-child(1) > input")).sendKeys(process.env.Y_USERNAME)
    await driver.findElement(By.css("#formSign > div:nth-child(2) > input")).click()
    await driver.findElement(By.css("#formSign > div:nth-child(2) > input")).sendKeys(process.env.Y_PASSWORD)

    
    await driver.sleep(4000);
    await driver.findElement(By.css(".upDate:nth-child(1) p")).click()
    vars["win6468"] = await waitForWindow(4000)
    await driver.switchTo().window(vars["win6468"])
    var count = await driver.findElement(By.css(".ly_geren:nth-child(2) > p"))
    console.log('硬币 ' + count.getText())

    await driver.quit();
}
s();
